import{c as A,j as e,r as p}from"./assets/client-CAizLhZc.js";import{R as F,A as R,C as B,X as D,Y as $,T as L,a as E}from"./assets/AreaChart-DWmB5lgi.js";function M(t){const[i,a]=p.useState(()=>{var n;return(n=window.openai)==null?void 0:n[t]});return p.useEffect(()=>{const r=l=>{var g;const s=(g=window.openai)==null?void 0:g[t];s!==void 0&&(console.log(`[useOpenAiGlobal] ${t} updated:`,s),a(s))};window.addEventListener("openai:set_globals",r);const n=setInterval(()=>{var s;const c=(s=window.openai)==null?void 0:s[t];c!==void 0&&c!==i&&(console.log(`[useOpenAiGlobal] ${t} found via polling:`,c),a(c),clearInterval(n))},100);return()=>{window.removeEventListener("openai:set_globals",r),clearInterval(n)}},[t,i]),i}function O(){return M("toolOutput")}const P=({active:t,payload:i})=>{if(t&&i&&i.length){const a=i[0].payload,n=new Date(a.time*1e3).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsxs("div",{style:{background:"rgba(255, 255, 255, 0.95)",border:"1px solid #ccc",borderRadius:"4px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx("div",{style:{fontSize:"11px",color:"#666",marginBottom:"4px"},children:n}),e.jsxs("div",{style:{fontSize:"14px",fontWeight:"bold"},children:["$",a.price.toFixed(2)]})]})}return null},G=({stockData:t,marketData:i,chartData:a})=>{const[r,n]=p.useState("1D"),[l,c]=p.useState(a),[s,g]=p.useState(!1),w=async o=>{g(!0),n(o);try{const d=await fetch(`https://hellostake.com/api/us/chart/${t.ticker}/${o}`,{method:"GET",credentials:"include",headers:{Accept:"application/json"}});if(d.ok){const C=(await d.json()).map(x=>({time:x[0]/1e3,price:x[4],open:x[1],high:x[2],low:x[3],volume:x[5]}));c(C)}}catch(d){console.error("Error fetching chart data:",d)}finally{g(!1)}},h=l.map(o=>o.price),k=h[h.length-1]||i.lastTrade,u=i.dailyReturnQuote,T=i.dailyReturnPercentageQuote,m=u>=0?"#00C853":"#D32F2F",f=u>=0?"+":"",z=o=>{const d=new Date(o*1e3);return r==="1D"?d.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):d.toLocaleDateString("en-US",{month:"short",day:"numeric"})},y=l.map(o=>({...o,timeFormatted:z(o.time)})),b=Math.min(...h),j=Math.max(...h),v=(j-b)*.1,W=[b-v,j+v];return e.jsxs("div",{style:{padding:"24px",fontFamily:"system-ui",maxWidth:"1200px",margin:"0 auto"},children:[e.jsx("div",{style:{marginBottom:"32px"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{children:[e.jsx("h1",{style:{margin:0,fontSize:"32px",fontWeight:"bold"},children:t.ticker}),e.jsx("div",{style:{fontSize:"16px",color:"#666",marginTop:"4px"},children:t.companyName})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsxs("div",{style:{fontSize:"36px",fontWeight:"bold"},children:["$",k.toFixed(2)]}),e.jsxs("div",{style:{color:m,fontSize:"18px",fontWeight:"500"},children:[f,"$",Math.abs(u).toFixed(2)," (",f,T.toFixed(2),"%)"]})]})]})}),e.jsxs("div",{style:{marginBottom:"32px",textAlign:"center"},children:[e.jsxs("a",{href:`https://trading.hellostake.com/platform/instrument/us-trading/${t.ticker}`,target:"_blank",rel:"noopener noreferrer",style:{display:"inline-block",padding:"20px 48px",background:"#000",color:"white",fontSize:"24px",fontWeight:"bold",textDecoration:"none",borderRadius:"8px",transition:"all 0.2s ease",cursor:"pointer"},onMouseOver:o=>{o.currentTarget.style.background="#333"},onMouseOut:o=>{o.currentTarget.style.background="#000"},children:["Trade ",t.ticker," on Stake"]}),e.jsx("div",{style:{marginTop:"12px",fontSize:"14px",color:"#666"},children:"Available on Stake - Start trading in minutes"})]}),e.jsxs("div",{style:{marginBottom:"32px",background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h3",{style:{fontSize:"18px",margin:0,fontWeight:"600"},children:"Price Chart"}),e.jsx("div",{style:{display:"flex",gap:"8px"},children:["1D","1W","1M","1Y"].map(o=>e.jsx("button",{onClick:()=>w(o),disabled:s,style:{padding:"8px 16px",border:r===o?"2px solid #000":"1px solid #e0e0e0",background:r===o?"#000":"white",color:r===o?"white":"#666",fontWeight:r===o?"bold":"normal",borderRadius:"8px",cursor:s?"wait":"pointer",fontSize:"14px",transition:"all 0.2s ease",opacity:s?.6:1},children:o},o))})]}),e.jsx(F,{width:"100%",height:350,children:e.jsxs(R,{data:y,margin:{top:10,right:30,left:0,bottom:0},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorPriceTrading",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:m,stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:m,stopOpacity:0})]})}),e.jsx(B,{strokeDasharray:"3 3",stroke:"#e0e0e0"}),e.jsx(D,{dataKey:"timeFormatted",stroke:"#666",tick:{fontSize:11},interval:"preserveStartEnd",tickFormatter:(o,d)=>d%Math.floor(y.length/6)===0?o:""}),e.jsx($,{stroke:"#666",tick:{fontSize:12},domain:W,tickFormatter:o=>`$${o.toFixed(2)}`}),e.jsx(L,{content:e.jsx(P,{})}),e.jsx(E,{type:"monotone",dataKey:"price",stroke:m,strokeWidth:2,fill:"url(#colorPriceTrading)",animationDuration:300})]})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:"16px",marginBottom:"24px"},children:[e.jsxs("div",{style:{padding:"20px",background:"white",border:"1px solid #e0e0e0",borderRadius:"12px",boxShadow:"0 1px 3px rgba(0,0,0,0.05)"},children:[e.jsx("div",{style:{fontSize:"12px",color:"#666",marginBottom:"8px",textTransform:"uppercase"},children:"Open"}),e.jsxs("div",{style:{fontSize:"20px",fontWeight:"bold"},children:["$",i.open.toFixed(2)]})]}),e.jsxs("div",{style:{padding:"20px",background:"white",border:"1px solid #e0e0e0",borderRadius:"12px",boxShadow:"0 1px 3px rgba(0,0,0,0.05)"},children:[e.jsx("div",{style:{fontSize:"12px",color:"#666",marginBottom:"8px",textTransform:"uppercase"},children:"High"}),e.jsxs("div",{style:{fontSize:"20px",fontWeight:"bold",color:"#00C853"},children:["$",i.high.toFixed(2)]})]}),e.jsxs("div",{style:{padding:"20px",background:"white",border:"1px solid #e0e0e0",borderRadius:"12px",boxShadow:"0 1px 3px rgba(0,0,0,0.05)"},children:[e.jsx("div",{style:{fontSize:"12px",color:"#666",marginBottom:"8px",textTransform:"uppercase"},children:"Low"}),e.jsxs("div",{style:{fontSize:"20px",fontWeight:"bold",color:"#D32F2F"},children:["$",i.low.toFixed(2)]})]}),e.jsxs("div",{style:{padding:"20px",background:"white",border:"1px solid #e0e0e0",borderRadius:"12px",boxShadow:"0 1px 3px rgba(0,0,0,0.05)"},children:[e.jsx("div",{style:{fontSize:"12px",color:"#666",marginBottom:"8px",textTransform:"uppercase"},children:"Volume"}),e.jsx("div",{style:{fontSize:"20px",fontWeight:"bold"},children:i.volume.toLocaleString()})]}),t.marketCap&&e.jsxs("div",{style:{padding:"20px",background:"white",border:"1px solid #e0e0e0",borderRadius:"12px",boxShadow:"0 1px 3px rgba(0,0,0,0.05)"},children:[e.jsx("div",{style:{fontSize:"12px",color:"#666",marginBottom:"8px",textTransform:"uppercase"},children:"Market Cap"}),e.jsx("div",{style:{fontSize:"20px",fontWeight:"bold"},children:t.marketCap})]}),t.fiftyTwoWeekHigh&&e.jsxs("div",{style:{padding:"20px",background:"white",border:"1px solid #e0e0e0",borderRadius:"12px",boxShadow:"0 1px 3px rgba(0,0,0,0.05)"},children:[e.jsx("div",{style:{fontSize:"12px",color:"#666",marginBottom:"8px",textTransform:"uppercase"},children:"52W High"}),e.jsx("div",{style:{fontSize:"20px",fontWeight:"bold"},children:t.fiftyTwoWeekHigh})]})]}),e.jsxs("div",{style:{background:"#f5f5f5",padding:"20px",borderRadius:"8px",border:"1px solid #e0e0e0",textAlign:"center"},children:[e.jsxs("div",{style:{fontSize:"16px",fontWeight:"600",color:"#333",marginBottom:"8px"},children:["Yes, you can trade ",t.ticker," on Stake"]}),e.jsx("div",{style:{fontSize:"14px",color:"#666"},children:"Commission-free trading • Real-time market data • Instant deposits"})]})]})},I=()=>{var r;const t=O();p.useEffect(()=>{var n,l;console.log("[TradingWidget] toolOutput changed:",t),console.log("[TradingWidget] window.openai:",window.openai),console.log("[TradingWidget] toolOutput keys:",t?Object.keys(t):"undefined"),console.log("[TradingWidget] toolOutput?.result:",t==null?void 0:t.result),console.log("[TradingWidget] structuredContent path check:",{hasToolOutput:!!t,hasResult:!!(t!=null&&t.result),hasStructuredContent:!!((n=t==null?void 0:t.result)!=null&&n.structuredContent),actualPath:(l=t==null?void 0:t.result)==null?void 0:l.structuredContent})},[t]);const i=((r=t==null?void 0:t.result)==null?void 0:r.structuredContent)||t;if(!i||!i.stockSymbol)return e.jsxs("div",{style:{padding:"40px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"18px",marginBottom:"8px"},children:"Loading trading information..."}),e.jsx("div",{style:{fontSize:"14px",color:"#999"},children:"Checking stock availability on Stake"}),e.jsxs("div",{style:{fontSize:"10px",color:"#ccc",marginTop:"20px",fontFamily:"monospace"},children:["Debug: ",t?"toolOutput exists":"toolOutput is undefined",t&&` | Keys: ${Object.keys(t).join(", ")}`]})]});if(i.available===!1)return e.jsxs("div",{style:{padding:"60px 40px",textAlign:"center",fontFamily:"system-ui",maxWidth:"600px",margin:"0 auto"},children:[e.jsxs("h2",{style:{fontSize:"28px",fontWeight:"bold",marginBottom:"16px",color:"#333"},children:["Sorry, ",i.stockSymbol," isn't available on Stake"]}),e.jsx("p",{style:{fontSize:"16px",color:"#666",lineHeight:"1.6",marginBottom:"32px"},children:"This stock is not currently available for trading on Stake. Try searching for another US-listed stock instead."}),e.jsxs("div",{style:{background:"#f5f5f5",padding:"24px",borderRadius:"8px",border:"1px solid #e0e0e0"},children:[e.jsx("div",{style:{fontSize:"14px",fontWeight:"600",marginBottom:"12px",color:"#666"},children:"Popular stocks available on Stake:"}),e.jsx("div",{style:{display:"flex",gap:"12px",justifyContent:"center",flexWrap:"wrap"},children:["AAPL","TSLA","NVDA","MSFT","GOOGL","AMZN","META"].map(n=>e.jsx("div",{style:{padding:"8px 16px",background:"white",border:"1px solid #ddd",borderRadius:"8px",fontSize:"14px",fontWeight:"500",color:"#333"},children:n},n))})]})]});if(!i.stockData||!i.marketData||!i.chartData)return e.jsxs("div",{style:{padding:"40px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"18px",marginBottom:"8px"},children:"Loading trading information..."}),e.jsxs("div",{style:{fontSize:"14px",color:"#999"},children:["Fetching data for ",i.stockSymbol,"..."]})]});const a=Array.isArray(i.marketData)?i.marketData[0]:i.marketData;return e.jsx(G,{stockData:i.stockData,marketData:a,chartData:i.chartData})},S=document.getElementById("trading-widget-root");S&&A(S).render(e.jsx(I,{}));
