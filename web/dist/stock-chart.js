import{c as $,j as t,r as d}from"./assets/client-CAizLhZc.js";import{R as A,A as B,C as W,X as E,Y as L,T as R,a as O}from"./assets/AreaChart-DWmB5lgi.js";function P(o){const[s,r]=d.useState(()=>{var i;return(i=window.openai)==null?void 0:i[o]});return d.useEffect(()=>{const n=x=>{var g;const c=(g=window.openai)==null?void 0:g[o];c!==void 0&&(console.log(`[useOpenAiGlobal] ${o} updated:`,c),r(c))};window.addEventListener("openai:set_globals",n);const i=setInterval(()=>{var c;const l=(c=window.openai)==null?void 0:c[o];l!==void 0&&l!==s&&(console.log(`[useOpenAiGlobal] ${o} found via polling:`,l),r(l),clearInterval(i))},100);return()=>{window.removeEventListener("openai:set_globals",n),clearInterval(i)}},[o,s]),s}function M(){return P("toolOutput")}const G=({active:o,payload:s})=>{if(o&&s&&s.length){const r=s[0].payload,i=new Date(r.time*1e3).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"});return t.jsxs("div",{style:{background:"rgba(255, 255, 255, 0.95)",border:"1px solid #ccc",borderRadius:"4px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[t.jsx("div",{style:{fontSize:"12px",color:"#666",marginBottom:"4px"},children:i}),t.jsxs("div",{style:{fontSize:"14px",fontWeight:"bold",marginBottom:"4px"},children:["$",r.price.toFixed(2)]}),r.open!==void 0&&t.jsxs("div",{style:{fontSize:"11px",color:"#666"},children:["O: $",r.open.toFixed(2)," | H: $",r.high.toFixed(2)," | L: $",r.low.toFixed(2)]}),r.volume!==void 0&&t.jsxs("div",{style:{fontSize:"11px",color:"#666",marginTop:"4px"},children:["Vol: ",r.volume.toLocaleString()]})]})}return null},I=({stockData:o,chartData:s})=>{const[r,n]=d.useState("1D"),[i,x]=d.useState(s),[l,c]=d.useState(!1),g=async e=>{c(!0),n(e);try{console.log(`Fetching ${e} chart data for ${o.ticker}`);const a=await fetch(`https://hellostake.com/api/us/chart/${o.ticker}/${e}`,{method:"GET",credentials:"include",headers:{Accept:"application/json"}});if(!a.ok)throw new Error(`Failed to fetch chart data: ${a.status}`);const k=await a.json();console.log(`Fetched ${k.length} data points for ${e}`);const T=k.map(p=>({time:p[0]/1e3,price:p[4],open:p[1],high:p[2],low:p[3],volume:p[5]}));x(T)}catch(a){console.error("Error fetching chart data:",a)}finally{c(!1)}},h=i.map(e=>e.price),v=h[h.length-1]||0,m=h[0]||0,u=v-m,D=m>0?u/m*100:0,f=u>=0?"#00C853":"#D32F2F",b=u>=0?"+":"",z=e=>{const a=new Date(e*1e3);switch(r){case"1D":return a.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"});case"1W":return a.toLocaleDateString("en-US",{month:"short",day:"numeric"});case"1M":case"1Y":return a.toLocaleDateString("en-US",{month:"short",day:"numeric"});default:return a.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}},S=i.map(e=>({...e,timeFormatted:z(e.time)})),y=Math.min(...h),j=Math.max(...h),w=(j-y)*.1,C=[y-w,j+w];return t.jsxs("div",{style:{padding:"20px",fontFamily:"system-ui",maxWidth:"1000px",margin:"0 auto"},children:[t.jsxs("div",{style:{marginBottom:"20px"},children:[t.jsx("h2",{style:{margin:0,fontSize:"24px"},children:o.ticker}),t.jsx("div",{style:{fontSize:"14px",color:"#666",marginTop:"4px"},children:o.companyName})]}),t.jsxs("div",{style:{background:"#f5f5f5",padding:"24px",borderRadius:"12px",marginBottom:"32px",textAlign:"center"},children:[t.jsx("div",{style:{fontSize:"14px",color:"#666",marginBottom:"8px",textTransform:"uppercase",letterSpacing:"0.5px"},children:"Current Price"}),t.jsxs("div",{style:{fontSize:"48px",fontWeight:"bold",marginBottom:"8px"},children:["$",v.toFixed(2)]}),t.jsxs("div",{style:{color:f,fontSize:"20px",fontWeight:"500"},children:[b,"$",Math.abs(u).toFixed(2)," (",b,D.toFixed(2),"%)"]})]}),t.jsxs("div",{style:{marginBottom:"32px"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[t.jsx("h3",{style:{fontSize:"18px",margin:0,fontWeight:"600"},children:"Price Chart"}),t.jsx("div",{style:{display:"flex",gap:"8px"},children:["1D","1W","1M","1Y"].map(e=>t.jsx("button",{onClick:()=>g(e),disabled:l,style:{padding:"8px 16px",border:r===e?"2px solid #000":"1px solid #e0e0e0",background:r===e?"#000":"white",color:r===e?"white":"#666",fontWeight:r===e?"bold":"normal",borderRadius:"8px",cursor:l?"wait":"pointer",fontSize:"14px",transition:"all 0.2s ease",opacity:l?.6:1},children:e},e))})]}),t.jsx(A,{width:"100%",height:400,children:t.jsxs(B,{data:S,margin:{top:10,right:30,left:0,bottom:0},children:[t.jsx("defs",{children:t.jsxs("linearGradient",{id:"colorPrice",x1:"0",y1:"0",x2:"0",y2:"1",children:[t.jsx("stop",{offset:"5%",stopColor:f,stopOpacity:.3}),t.jsx("stop",{offset:"95%",stopColor:f,stopOpacity:0})]})}),t.jsx(W,{strokeDasharray:"3 3",stroke:"#e0e0e0"}),t.jsx(E,{dataKey:"timeFormatted",stroke:"#666",tick:{fontSize:11},interval:"preserveStartEnd",tickFormatter:(e,a)=>a%Math.floor(S.length/6)===0?e:""}),t.jsx(L,{stroke:"#666",tick:{fontSize:12},domain:C,tickFormatter:e=>`$${e.toFixed(2)}`}),t.jsx(R,{content:t.jsx(G,{})}),t.jsx(O,{type:"monotone",dataKey:"price",stroke:f,strokeWidth:2,fill:"url(#colorPrice)",animationDuration:300})]})})]}),t.jsx("div",{style:{marginBottom:"24px",textAlign:"center"},children:t.jsxs("a",{href:`https://trading.hellostake.com/platform/instrument/us-trading/${o.ticker}`,target:"_blank",rel:"noopener noreferrer",style:{display:"inline-block",padding:"16px 32px",background:"#000",color:"white",fontSize:"18px",fontWeight:"bold",textDecoration:"none",borderRadius:"8px",transition:"all 0.2s ease",cursor:"pointer"},onMouseOver:e=>{e.currentTarget.style.background="#333"},onMouseOut:e=>{e.currentTarget.style.background="#000"},children:["Trade ",o.ticker," on Stake"]})}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"16px",marginBottom:"24px"},children:[t.jsxs("div",{style:{padding:"20px",background:"#fff",border:"1px solid #e0e0e0",borderRadius:"12px"},children:[t.jsx("div",{style:{fontSize:"12px",color:"#666",marginBottom:"8px",textTransform:"uppercase"},children:"Open"}),t.jsxs("div",{style:{fontSize:"24px",fontWeight:"bold"},children:["$",m.toFixed(2)]})]}),t.jsxs("div",{style:{padding:"20px",background:"#fff",border:"1px solid #e0e0e0",borderRadius:"12px"},children:[t.jsx("div",{style:{fontSize:"12px",color:"#666",marginBottom:"8px",textTransform:"uppercase"},children:"High"}),t.jsxs("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#00C853"},children:["$",j.toFixed(2)]})]}),t.jsxs("div",{style:{padding:"20px",background:"#fff",border:"1px solid #e0e0e0",borderRadius:"12px"},children:[t.jsx("div",{style:{fontSize:"12px",color:"#666",marginBottom:"8px",textTransform:"uppercase"},children:"Low"}),t.jsxs("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#D32F2F"},children:["$",y.toFixed(2)]})]}),t.jsxs("div",{style:{padding:"20px",background:"#fff",border:"1px solid #e0e0e0",borderRadius:"12px"},children:[t.jsx("div",{style:{fontSize:"12px",color:"#666",marginBottom:"8px",textTransform:"uppercase"},children:"Data Points"}),t.jsx("div",{style:{fontSize:"24px",fontWeight:"bold"},children:i.length})]})]})]})},U=()=>{var x;const o=M(),[s,r]=d.useState(null);if(d.useEffect(()=>{console.log("[StockChart] toolOutput changed:",o)},[o]),s)return t.jsx("div",{style:{padding:"20px",color:"#D32F2F"},children:s});const n=((x=o==null?void 0:o.result)==null?void 0:x.structuredContent)||o;if(!n||!n.stockData||!n.chartData)return t.jsxs("div",{style:{padding:"20px"},children:[t.jsx("div",{children:"Loading stock chart..."}),t.jsx("div",{style:{fontSize:"12px",color:"#999",marginTop:"8px"},children:"Waiting for chart data from MCP server"})]});const i=Array.isArray(n.chartData)?n.chartData:[];return i.length===0?t.jsxs("div",{style:{padding:"20px",color:"#D32F2F"},children:["No chart data available for ",n.stockData.ticker]}):t.jsx(I,{stockData:n.stockData,chartData:i})},F=document.getElementById("stock-chart-root");F&&$(F).render(t.jsx(U,{}));
